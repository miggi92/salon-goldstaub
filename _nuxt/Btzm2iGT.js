import{c$ as de,cZ as U,aY as te,r as N,L as ie,a$ as ce,aZ as le,C as R,a_ as fe,d0 as ve,D as z,h as B,w as P,e as L,K as x,P as oe,b0 as G,ah as W,E as ue,ab as pe,c_ as he,H as me,d1 as ae,B as ge,x as ye,aa as be,aX as xe,c as O,f as j,F as ne,Q as Ce,n as V,ai as ke,d as re,a3 as Te,t as Ke}from"./BWm3GPoP.js";import{c as Ie}from"./Cd5B9FOt.js";import{t as se}from"./DgBCHtU6.js";import Se from"./BC54CQ28.js";import{_ as Ae,M as Ee,a as _e}from"./meMHKq0A.js";import{u as we}from"./AxSfCegK.js";import"./DZXwfb0L.js";function Ve(s){const n=de("",1e3);return{search:n,handleTypeaheadSearch:(I,l)=>{n.value=n.value+I;{const f=U(),v=l.map(y=>{var A,$;return{...y,textValue:((A=y.value)==null?void 0:A.textValue)??(($=y.ref.textContent)==null?void 0:$.trim())??""}}),i=v.find(y=>y.ref===f),g=v.map(y=>y.textValue),E=Re(g,n.value,i==null?void 0:i.textValue),C=v.find(y=>y.textValue===E);return C&&C.ref.focus(),C==null?void 0:C.ref}},resetTypeahead:()=>{n.value=""}}}function Be(s,n){return s.map((e,c)=>s[(n+c)%s.length])}function Re(s,n,e){const I=n.length>1&&Array.from(n).every(g=>g===n[0])?n[0]:n,l=e?s.indexOf(e):-1;let f=Be(s,Math.max(l,0));I.length===1&&(f=f.filter(g=>g!==e));const i=f.find(g=>g.toLowerCase().startsWith(I.toLowerCase()));return i!==e?i:void 0}function Y(s,n,e){const c=s.findIndex(v=>te(v,n)),I=s.findIndex(v=>te(v,e));if(c===-1||I===-1)return[];const[l,f]=[c,I].sort((v,i)=>v-i);return s.slice(l,f+1)}function H(s){return s.reduce((n,e)=>(n.push(e),e.children&&n.push(...H(e.children)),n),[])}function $e(s,n){const e=N(),c=(l,f)=>{if(n.multiple&&Array.isArray(s.value))if(n.selectionBehavior==="replace")s.value=[l],e.value=l;else{const v=s.value.findIndex(i=>f(i));v!==-1?s.value=s.value.filter((i,g)=>g!==v):s.value=[...s.value,l]}else n.selectionBehavior==="replace"?s.value={...l}:!Array.isArray(s.value)&&f(s.value)?s.value=void 0:s.value={...l};return s.value};function I(l,f,v,i){var y;if(!(e!=null&&e.value)||!n.multiple||!Array.isArray(s.value))return;const E=(y=v().filter(A=>A.ref.dataset.disabled!=="").find(A=>A.ref===f))==null?void 0:y.value;if(!E)return;let C=null;switch(l){case"prev":case"next":{C=Y(i,e.value,E);break}case"first":{C=Y(i,e.value,i==null?void 0:i[0]);break}case"last":{C=Y(i,e.value,i==null?void 0:i[i.length-1]);break}}s.value=C}return{firstValue:e,onSelectItem:c,handleMultipleReplace:I}}const[Le,Me]=fe("TreeRoot"),Pe=ie({__name:"TreeRoot",props:{modelValue:{},defaultValue:{},items:{},expanded:{},defaultExpanded:{},getKey:{},getChildren:{type:Function,default:s=>s.children},selectionBehavior:{default:"toggle"},multiple:{},dir:{},disabled:{type:Boolean},propagateSelect:{type:Boolean},bubbleSelect:{type:Boolean},asChild:{type:Boolean},as:{default:"ul"}},emits:["update:modelValue","update:expanded"],setup(s,{emit:n}){const e=s,c=n,{items:I,multiple:l,disabled:f,propagateSelect:v,dir:i,bubbleSelect:g}=ce(e),{handleTypeaheadSearch:E}=Ve(),C=we(i),y=N(),A=N(!1),$=ve(),a=le(e,"modelValue",c,{defaultValue:e.defaultValue??(l.value?[]:void 0),passive:e.modelValue===void 0,deep:!0}),o=le(e,"expanded",c,{defaultValue:e.defaultExpanded??[],passive:e.expanded===void 0,deep:!0}),{onSelectItem:t,handleMultipleReplace:r}=$e(a,e),u=R(()=>l.value&&Array.isArray(a.value)?a.value.map(d=>e.getKey(d)):[e.getKey(a.value??{})]);function p(d,m=1,b){return d.reduce((S,k,w)=>{const M=e.getKey(k),D=e.getChildren(k),F=o.value.includes(M),q={_id:M,value:k,index:w,level:m,parentItem:b,hasChildren:!!D,bind:{value:k,level:m,"aria-setsize":d.length,"aria-posinset":w+1}};return S.push(q),D&&F&&S.push(...p(D,m+1,k)),S},[])}const h=R(()=>{const d=e.items;return o.value.map(m=>m),p(d??[])});function K(d){var m;if(A.value)$.trigger(d);else{const b=((m=y.value)==null?void 0:m.getItems())??[];E(d.key,b)}}function T(d){if(A.value)return;const m=Ee[d.key];pe(()=>{var b;r(m,U(),(b=y.value)==null?void 0:b.getItems,h.value.map(S=>S.value))})}function _(d){var m;if(d.parentItem!=null&&Array.isArray(a.value)&&e.multiple){const b=h.value.find(S=>d.parentItem!=null&&e.getKey(S.value)===e.getKey(d.parentItem));b!=null&&(((m=e.getChildren(b.value))==null?void 0:m.every(k=>a.value.find(w=>e.getKey(w)===e.getKey(k))))?a.value=[...a.value,b.value]:a.value=a.value.filter(k=>e.getKey(k)!==e.getKey(b.value)),_(b))}}return Me({modelValue:a,selectedKeys:u,onSelect:d=>{var S;const m=k=>e.getKey(k??{})===e.getKey(d),b=e.multiple&&Array.isArray(a.value)?((S=a.value)==null?void 0:S.findIndex(m))!==-1:void 0;if(t(d,m),e.bubbleSelect&&e.multiple&&Array.isArray(a.value)){const k=h.value.find(w=>e.getKey(w.value)===e.getKey(d));k!=null&&_(k)}if(e.propagateSelect&&e.multiple&&Array.isArray(a.value)){const k=H(e.getChildren(d)??[]);b?a.value=[...a.value].filter(w=>!k.some(M=>e.getKey(w??{})===e.getKey(M))):a.value=[...a.value,...k]}},expanded:o,onToggle(d){if(!(d?e.getChildren(d):void 0))return;const b=e.getKey(d)??d;o.value.includes(b)?o.value=o.value.filter(S=>S!==b):o.value.push(b)},getKey:e.getKey,getChildren:e.getChildren,items:I,expandedItems:h,disabled:f,multiple:l,dir:C,propagateSelect:v,bubbleSelect:g,isVirtual:A,virtualKeydownHook:$,handleMultipleReplace:r}),(d,m)=>(B(),z(x(Ae),{ref_key:"rovingFocusGroupRef",ref:y,"as-child":"",orientation:"vertical",dir:x(C)},{default:P(()=>[L(x(oe),{role:"tree",as:d.as,"as-child":d.asChild,"aria-multiselectable":x(l)?!0:void 0,onKeydown:[K,G(W(T,["shift"]),["up","down"])]},{default:P(()=>[ue(d.$slots,"default",{flattenItems:h.value,modelValue:x(a),expanded:x(o)})]),_:3},8,["as","as-child","aria-multiselectable","onKeydown"])]),_:3},8,["dir"]))}}),De="tree.select",Ne="tree.toggle",Oe=ie({inheritAttrs:!1,__name:"TreeItem",props:{value:{},level:{},asChild:{type:Boolean},as:{default:"li"}},emits:["select","toggle"],setup(s,{expose:n,emit:e}){const c=s,I=e,l=Le(),{getItems:f}=he(),v=R(()=>!!l.getChildren(c.value)),i=R(()=>{const t=l.getKey(c.value);return l.expanded.value.includes(t)}),g=R(()=>{const t=l.getKey(c.value);return l.selectedKeys.value.includes(t)}),E=R(()=>{if(l.bubbleSelect.value&&v.value&&Array.isArray(l.modelValue.value)){const t=H(l.getChildren(c.value)||[]);return t.some(r=>l.modelValue.value.find(u=>l.getKey(u)===l.getKey(r)))&&!t.every(r=>l.modelValue.value.find(u=>l.getKey(u)===l.getKey(r)))}else return l.propagateSelect.value&&g.value&&v.value&&Array.isArray(l.modelValue.value)?!H(l.getChildren(c.value)||[]).every(r=>l.modelValue.value.find(u=>l.getKey(u)===l.getKey(r))):void 0});function C(t){if(v.value)if(i.value){const r=f().map(T=>T.ref),u=U(),p=r.indexOf(u),K=[...r].slice(p).find(T=>Number(T.getAttribute("data-indent"))===c.level+1);K&&K.focus()}else o(t)}function y(t){if(i.value)o(t);else{const r=f().map(T=>T.ref),u=U(),p=r.indexOf(u),K=[...r].slice(0,p).reverse().find(T=>Number(T.getAttribute("data-indent"))===c.level-1);K&&K.focus()}}async function A(t){I("select",t),!(t!=null&&t.defaultPrevented)&&l.onSelect(c.value)}async function $(t){I("toggle",t),!(t!=null&&t.defaultPrevented)&&l.onToggle(c.value)}async function a(t){if(!t)return;const r={originalEvent:t,value:c.value,isExpanded:i.value,isSelected:g.value};ae(De,A,r)}async function o(t){if(!t)return;const r={originalEvent:t,value:c.value,isExpanded:i.value,isSelected:g.value};ae(Ne,$,r)}return n({isExpanded:i,isSelected:g,isIndeterminate:E,handleToggle:()=>l.onToggle(c.value),handleSelect:()=>l.onSelect(c.value)}),(t,r)=>(B(),z(x(_e),{"as-child":"",value:t.value,"allow-shift-key":""},{default:P(()=>[L(x(oe),me(t.$attrs,{role:"treeitem",as:t.as,"as-child":t.asChild,"aria-selected":g.value,"aria-expanded":v.value?i.value:void 0,"aria-level":t.level,"data-indent":t.level,"data-selected":g.value?"":void 0,"data-expanded":i.value?"":void 0,onKeydown:[G(W(a,["self","prevent"]),["enter","space"]),r[0]||(r[0]=G(W(u=>x(l).dir.value==="ltr"?C(u):y(u),["prevent"]),["right"])),r[1]||(r[1]=G(W(u=>x(l).dir.value==="ltr"?y(u):C(u),["prevent"]),["left"]))],onClick:r[2]||(r[2]=W(u=>{a(u),o(u)},["stop"]))}),{default:P(()=>[ue(t.$slots,"default",{isExpanded:i.value,isSelected:g.value,isIndeterminate:E.value,handleSelect:()=>x(l).onSelect(t.value),handleToggle:()=>x(l).onToggle(t.value)})]),_:3},16,["as","as-child","aria-selected","aria-expanded","aria-level","data-indent","data-selected","data-expanded","onKeydown"])]),_:3},8,["value"]))}}),We={slots:{root:"relative lg:h-[450px] my-5 grid lg:grid-cols-3 border border-muted rounded-md",list:"isolate relative p-2 border-b lg:border-b-0 lg:border-e border-muted overflow-y-auto",item:"",listWithChildren:"ms-4.5 border-s border-default",itemWithChildren:"ps-1.5 -ms-px",link:"relative group peer w-full px-2.5 py-1.5 before:inset-y-px before:inset-x-0 flex items-center gap-1.5 text-sm before:absolute before:z-[-1] before:rounded-md focus:outline-none focus-visible:outline-none focus-visible:before:ring-inset focus-visible:before:ring-2",linkLeadingIcon:"size-4 shrink-0",linkLabel:"truncate",linkTrailing:"ms-auto inline-flex gap-1.5 items-center",linkTrailingIcon:"size-5 transform transition-transform duration-200 shrink-0 group-data-expanded:rotate-180",content:"overflow-hidden lg:col-span-2 flex flex-col [&>div]:my-0 [&>div]:flex-1 [&>div]:flex [&>div]:flex-col [&>div>div]:border-0 [&>div>pre]:border-b-0 [&>div>pre]:border-s-0 [&>div>pre]:border-e-0 [&>div>pre]:rounded-l-none [&>div>pre]:flex-1 [&>div]:overflow-y-auto"},variants:{active:{true:{link:"text-highlighted before:bg-elevated"},false:{link:["hover:text-highlighted hover:before:bg-elevated/50","transition-colors before:transition-colors"]}}}},Ye={__name:"ProseCodeTree",props:{defaultValue:{type:String,required:!1},expandAll:{type:Boolean,required:!1},class:{type:null,required:!1},ui:{type:null,required:!1}},setup(s){const n=s,e=ge(),c=ye(),[I,l]=Ie(),f=R(()=>{var a,o;return se({extend:se(We),...((o=(a=c.uiPro)==null?void 0:a.prose)==null?void 0:o.codeTree)||{}})()}),v=N(n.defaultValue?{path:n.defaultValue}:void 0),i=N(),g=N(1),E=R(()=>{var a,o;return g.value,((o=(a=e.default)==null?void 0:a.call(e))==null?void 0:o.flatMap(A).filter(Boolean))||[]}),C=R(()=>y(E.value));function y(a){const o=new Map,t=[];a.forEach(u=>{const p=u.label.split("/");let h="";p.forEach((K,T)=>{var _,d;if(h=h?`${h}/${K}`:K,!o.has(h)){const m={label:K,path:h,...T<p.length-1&&{children:[]}};o.set(h,m),T===0?t.push(m):(d=(_=o.get(p.slice(0,T).join("/")))==null?void 0:_.children)==null||d.push(m)}})});const r=u=>u.sort((p,h)=>!!p.children==!!h.children?p.label.localeCompare(h.label):h.children?1:-1).map(p=>({...p,children:p.children&&r(p.children)}));return r(t)}function A(a,o){var t,r,u,p;return typeof a.type=="symbol"?(t=a.children)==null?void 0:t.map(A):{label:((r=a.props)==null?void 0:r.filename)||((u=a.props)==null?void 0:u.label)||`${o}`,icon:(p=a.props)==null?void 0:p.icon,component:a}}const $=R(()=>{var t;if(n.expandAll){const r=new Set;return E.value.forEach(u=>{const p=u.label.split("/");for(let h=1;h<p.length;h++)r.add(p.slice(0,h).join("/"))}),Array.from(r)}const a=(t=v.value)==null?void 0:t.path;if(!a)return[];const o=a.split("/");return o.map((r,u)=>o.slice(0,u+1).join("/"))});return be(v,a=>{const o=E.value.find(t=>(a==null?void 0:a.path)===t.label);o!=null&&o.component&&(i.value=o)},{immediate:!0}),xe(()=>g.value++),(a,o)=>{var r,u,p,h;const t=Te;return B(),O(ne,null,[L(x(I),null,{default:P(({items:K,level:T})=>[(B(!0),O(ne,null,Ce(K,(_,d)=>{var m,b;return B(),O("li",{key:`${T}-${d}`,class:V(T>0?f.value.itemWithChildren({class:(m=n.ui)==null?void 0:m.itemWithChildren}):f.value.item({class:(b=n.ui)==null?void 0:b.item}))},[L(x(Oe),{"as-child":"",level:T,value:_},{default:P(({isExpanded:S,isSelected:k})=>{var w,M,D,F,q,Z,Q,X,J,ee;return[j("button",{class:V(f.value.link({class:(w=n.ui)==null?void 0:w.link,active:k}))},[(M=_.children)!=null&&M.length?(B(),z(t,{key:0,name:S?x(c).ui.icons.folderOpen:x(c).ui.icons.folder,class:V(f.value.linkLeadingIcon({class:(D=n.ui)==null?void 0:D.linkLeadingIcon}))},null,8,["name","class"])):(B(),z(Se,{key:1,filename:_.label,class:V(f.value.linkLeadingIcon({class:(F=n.ui)==null?void 0:F.linkLeadingIcon}))},null,8,["filename","class"])),j("span",{class:V(f.value.linkLabel({class:(q=n.ui)==null?void 0:q.linkLabel}))},Ke(_.label),3),(Z=_.children)!=null&&Z.length?(B(),O("span",{key:2,class:V(f.value.linkTrailing({class:(Q=n.ui)==null?void 0:Q.linkTrailing}))},[L(t,{name:x(c).ui.icons.chevronDown,class:V(f.value.linkTrailingIcon({class:(X=n.ui)==null?void 0:X.linkTrailingIcon}))},null,8,["name","class"])],2)):re("",!0)],2),(J=_.children)!=null&&J.length&&S?(B(),O("ul",{key:0,class:V(f.value.listWithChildren({class:(ee=n.ui)==null?void 0:ee.listWithChildren}))},[L(x(l),{items:_.children,level:T+1},null,8,["items","level"])],2)):re("",!0)]}),_:2},1032,["level","value"])],2)}),128))]),_:1}),j("div",{class:V(f.value.root({class:[(r=n.ui)==null?void 0:r.root,n.class]}))},[L(x(Pe),{modelValue:v.value,"onUpdate:modelValue":o[0]||(o[0]=K=>v.value=K),class:V(f.value.list({class:(u=n.ui)==null?void 0:u.list})),items:C.value,"get-key":K=>K.path,"default-expanded":$.value},{default:P(()=>[L(x(l),{items:C.value,level:0},null,8,["items"])]),_:1},8,["modelValue","class","items","get-key","default-expanded"]),j("div",{class:V(f.value.content({class:(p=n.ui)==null?void 0:p.content}))},[(B(),z(ke((h=i.value)==null?void 0:h.component)))],2)],2)],64)}}};export{Ye as default};
